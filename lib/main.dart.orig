import 'dart:async';
import 'vpnclient_engine/engine.dart';

void main() async {
  VPNclientEngine.initialize();
  VPNclientEngine.ClearSubscriptions();
<<<<<<< HEAD

  // Add subscription
  VPNclientEngine.addSubscription(
    subscriptionURL: "https://pastebin.com/raw/ZCYiJ98W",
  );
  //VPNclientEngine.addSubscriptions(subscriptionURLs: ["https://pastebin.com/raw/ZCYiJ98W"]);

  // Update subscription
||||||| parent of 8b139ce (Cleanup messy code)

  // Add subscription
  VPNclientEngine.addSubscription(subscriptionURL: "https://pastebin.com/raw/ZCYiJ98W");
  //VPNclientEngine.addSubscriptions(subscriptionURLs: ["https://pastebin.com/raw/ZCYiJ98W"]);

  // Update subscription
=======
  VPNclientEngine.addSubscription(
    subscriptionURL: "https://pastebin.com/raw/ZCYiJ98W",
  );
>>>>>>> 8b139ce (Cleanup messy code)
  await VPNclientEngine.updateSubscription(subscriptionIndex: 0);

  VPNclientEngine.onConnectionStatusChanged.listen((status) {
    print("Connection status: $status");
  });

  await VPNclientEngine.connect(subscriptionIndex: 0, serverIndex: 1);

  VPNclientEngine.setRoutingRules(
    rules: [
      RoutingRule(appName: "YouTube", action: "proxy"),
      RoutingRule(appName: "google.com", action: "direct"),
      RoutingRule(domain: "ads.com", action: "block"),
    ],
  );

  VPNclientEngine.pingServer(subscriptionIndex: 0, index: 1);

  VPNclientEngine.onPingResult.listen((result) {
    print("Ping result: ${result.latencyInMs} ms");
  });

  await Future.delayed(Duration(seconds: 10));

  await VPNclientEngine.disconnect();
}
